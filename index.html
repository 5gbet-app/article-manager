<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ç« ç®¡ç†æ¨¡å— - Markdownç¼–è¾‘å™¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="logo">
                <a href="#" class="logo">ğŸ“ æ–‡ç« ç®¡ç†</a>
            </div>
            <div class="header-buttons">
                <a href="./test.html" class="btn btn-primary">å¸®åŠ©</a>
                <a href="./test.html" class="btn btn-secondary">å…³äº</a>
            </div>
        </div>
    </header>

    <!-- Article Manager Section -->
    <section class="article-manager-section">
        <div class="article-manager-container">
            <div class="article-manager-header">
                <h1 class="article-manager-title">ğŸ“ æ–‡ç« ç®¡ç†æ¨¡å—</h1>
                <p class="article-manager-subtitle">åˆ›å»ºå’Œç®¡ç†åšå®¢æ–‡ç« ï¼Œæ”¯æŒæ‰€æœ‰é«˜çº§åŠŸèƒ½</p>
            </div>

            <form id="articleForm">
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">æ–‡ç« æ ‡é¢˜ *</label>
                            <input type="text" class="form-input" id="title" name="title" required placeholder="è¾“å…¥æ–‡ç« æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å‘å¸ƒæ—¥æœŸ *</label>
                            <input type="date" class="form-input" id="date" name="date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ä½œè€… *</label>
                            <input type="text" class="form-input" id="author" name="author" required placeholder="ä½œè€…åç§°" value="ä½œè€…">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æµè§ˆé‡</label>
                            <input type="number" class="form-input" id="views" name="views" placeholder="æµè§ˆé‡" value="1000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é˜…è¯»æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                            <input type="number" class="form-input" id="reading_time" name="reading_time" placeholder="é˜…è¯»æ—¶é—´" value="5">
                        </div>
                    </div>
                </div>

                <!-- æ ‡ç­¾ç®¡ç† -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ·ï¸ æ ‡ç­¾ç®¡ç†</h3>
                    <div class="form-group">
                        <label class="form-label">æ·»åŠ æ ‡ç­¾</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-input" id="tagInput" placeholder="è¾“å…¥æ ‡ç­¾åç§°">
                            <button type="button" class="add-button" onclick="addTag()">æ·»åŠ æ ‡ç­¾</button>
                        </div>
                        <div class="tags-container" id="tagsContainer"></div>
                    </div>
                </div>

                <!-- æ‘˜è¦ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ“ æ–‡ç« æ‘˜è¦</h3>
                    <div class="form-group">
                        <label class="form-label">æ‘˜è¦å†…å®¹ *</label>
                        <textarea class="form-textarea" id="excerpt" name="excerpt" required placeholder="è¾“å…¥æ–‡ç« æ‘˜è¦ï¼Œç”¨äºåˆ—è¡¨é¡µæ˜¾ç¤º"></textarea>
                    </div>
                </div>

                <!-- å°é¢å›¾ç‰‡ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ–¼ï¸ å°é¢å›¾ç‰‡</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">å°é¢å›¾ç‰‡URL</label>
                            <input type="url" class="form-input" id="image_cover" name="image_cover" placeholder="https://example.com/images/cover.webp">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å°é¢å›¾ç‰‡Altæ–‡æœ¬</label>
                            <input type="text" class="form-input" id="image_cover_alt" name="image_cover_alt" placeholder="å°é¢å›¾ç‰‡æè¿°">
                        </div>
                    </div>
                </div>

                <!-- è§†é¢‘å’Œæ¸¸æˆ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ® è§†é¢‘å’Œæ¸¸æˆ</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">YouTubeè§†é¢‘ID</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="color: #f0f0f0; font-size: 14px;">https://www.youtube.com/embed/</span>
                                <input type="text" class="form-input" id="video_id" name="video_id" placeholder="dQw4w9WgXcQ" style="flex: 1;">
                            </div>
                            <small style="color: rgba(240, 240, 240, 0.7); font-size: 12px; margin-top: 5px; display: block;">
                                åªéœ€å¡«å†™YouTubeè§†é¢‘IDï¼Œä¾‹å¦‚ï¼šdQw4w9WgXcQ
                            </small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ¸¸æˆURL</label>
                            <input type="url" class="form-input" id="game_url" name="game_url" placeholder="æ¸¸æˆè¯•ç©é“¾æ¥">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ¸¸æˆæ ‡é¢˜</label>
                            <input type="text" class="form-input" id="game_title" name="game_title" placeholder="æ¸¸æˆåç§°">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ¸¸æˆå›¾ç‰‡</label>
                            <input type="url" class="form-input" id="game_image" name="game_image" placeholder="æ¸¸æˆå°é¢å›¾ç‰‡">
                        </div>
                    </div>
                </div>

                <!-- å†…å®¹å›¾ç‰‡ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ–¼ï¸ å†…å®¹å›¾ç‰‡</h3>
                    <div class="form-group">
                        <label class="form-label">æ·»åŠ å†…å®¹å›¾ç‰‡</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="url" class="form-input" id="imageUrl" placeholder="å›¾ç‰‡URL">
                            <input type="text" class="form-input" id="imageAlt" placeholder="å›¾ç‰‡Altæ–‡æœ¬">
                            <button type="button" class="add-button" onclick="addImage()">æ·»åŠ å›¾ç‰‡</button>
                        </div>
                        <div class="images-container" id="imagesContainer"></div>
                    </div>
                </div>

                <!-- æ–‡ç« å†…å®¹ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ“„ æ–‡ç« å†…å®¹</h3>
                    <div class="form-group">
                        <label class="form-label">æ–‡ç« å†…å®¹ *</label>
                        
                        <!-- å·¥å…·æ  -->
                        <div class="editor-toolbar">
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('**', '**', 'ç²—ä½“')" title="ç²—ä½“">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('*', '*', 'æ–œä½“')" title="æ–œä½“">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('~~', '~~', 'åˆ é™¤çº¿')" title="åˆ é™¤çº¿">
                                <i class="fas fa-strikethrough"></i>
                            </button>
                            <div class="toolbar-separator"></div>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('# ', '', 'æ ‡é¢˜1')" title="æ ‡é¢˜1">
                                <i class="fas fa-heading"></i>1
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('## ', '', 'æ ‡é¢˜2')" title="æ ‡é¢˜2">
                                <i class="fas fa-heading"></i>2
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('### ', '', 'æ ‡é¢˜3')" title="æ ‡é¢˜3">
                                <i class="fas fa-heading"></i>3
                            </button>
                            <div class="toolbar-separator"></div>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('- ', '', 'åˆ—è¡¨é¡¹')" title="æ— åºåˆ—è¡¨">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('1. ', '', 'åˆ—è¡¨é¡¹')" title="æœ‰åºåˆ—è¡¨">
                                <i class="fas fa-list-ol"></i>
                            </button>
                            <div class="toolbar-separator"></div>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('[', '](url)', 'é“¾æ¥æ–‡æœ¬')" title="é“¾æ¥">
                                <i class="fas fa-link"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('![', '](url)', 'å›¾ç‰‡æè¿°')" title="å›¾ç‰‡">
                                <i class="fas fa-image"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('`', '`', 'ä»£ç ')" title="è¡Œå†…ä»£ç ">
                                <i class="fas fa-code"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('```\n', '\n```', 'ä»£ç å—')" title="ä»£ç å—">
                                <i class="fas fa-file-code"></i>
                            </button>
                            <div class="toolbar-separator"></div>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('> ', '', 'å¼•ç”¨')" title="å¼•ç”¨">
                                <i class="fas fa-quote-left"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('---\n', '', '')" title="åˆ†å‰²çº¿">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                        
                        <!-- ç¼–è¾‘å™¨ -->
                        <div class="editor-container">
                            <textarea class="form-textarea editor-textarea" id="content" name="content" required placeholder="è¾“å…¥æ–‡ç« å†…å®¹ï¼Œæ”¯æŒMarkdownæ ¼å¼" style="min-height: 300px;"></textarea>
                            <div class="editor-preview" id="editorPreview"></div>
                        </div>
                        
                        <!-- ç¼–è¾‘å™¨åˆ‡æ¢ -->
                        <div class="editor-tabs">
                            <button type="button" class="tab-btn active" onclick="switchTab('edit')" id="editTab">
                                <i class="fas fa-edit"></i> ç¼–è¾‘
                            </button>
                            <button type="button" class="tab-btn" onclick="switchTab('preview')" id="previewTab">
                                <i class="fas fa-eye"></i> é¢„è§ˆ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- æäº¤æŒ‰é’® -->
                <div class="submit-section">
                    <button type="submit" class="submit-button">
                        <i class="fas fa-save"></i> ç”ŸæˆMarkdownæ–‡ä»¶
                    </button>
                </div>
            </form>

            <!-- é¢„è§ˆåŒºåŸŸ -->
            <div class="preview-section" id="previewSection" style="display: none;">
                <h3 class="preview-title">ğŸ“‹ Markdowné¢„è§ˆ</h3>
                <div class="preview-content" id="previewContent"></div>
            </div>

            <!-- æ¶ˆæ¯æç¤º -->
            <div id="alertContainer"></div>
        </div>
    </section>

    <script>
        // å…¨å±€å˜é‡
        let tags = [];
        let images = [];

        // é¡µé¢åŠ è½½æ—¶è®¾ç½®é»˜è®¤æ—¥æœŸ
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
        });

        // æ·»åŠ æ ‡ç­¾
        function addTag() {
            const tagInput = document.getElementById('tagInput');
            const tag = tagInput.value.trim();
            
            if (tag && !tags.includes(tag)) {
                tags.push(tag);
                updateTagsDisplay();
                tagInput.value = '';
            }
        }

        // æ›´æ–°æ ‡ç­¾æ˜¾ç¤º
        function updateTagsDisplay() {
            const container = document.getElementById('tagsContainer');
            container.innerHTML = '';
            
            tags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-item';
                tagElement.innerHTML = `
                    <span>${tag}</span>
                    <button type="button" class="tag-remove" onclick="removeTag('${tag}')">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(tagElement);
            });
        }

        // ç§»é™¤æ ‡ç­¾
        function removeTag(tag) {
            tags = tags.filter(t => t !== tag);
            updateTagsDisplay();
        }

        // æ·»åŠ å›¾ç‰‡
        function addImage() {
            const urlInput = document.getElementById('imageUrl');
            const altInput = document.getElementById('imageAlt');
            const url = urlInput.value.trim();
            const alt = altInput.value.trim();
            
            if (url) {
                images.push({ url, alt });
                updateImagesDisplay();
                urlInput.value = '';
                altInput.value = '';
            }
        }

        // æ›´æ–°å›¾ç‰‡æ˜¾ç¤º
        function updateImagesDisplay() {
            const container = document.getElementById('imagesContainer');
            container.innerHTML = '';
            
            images.forEach((image, index) => {
                const imageElement = document.createElement('div');
                imageElement.className = 'image-item';
                imageElement.innerHTML = `
                    <div>
                        <strong>URL:</strong> ${image.url}
                    </div>
                    <div>
                        <strong>Alt:</strong> ${image.alt || 'æ— æè¿°'}
                    </div>
                    <button type="button" class="image-remove" onclick="removeImage(${index})">
                        <i class="fas fa-trash"></i> åˆ é™¤
                    </button>
                `;
                container.appendChild(imageElement);
            });
        }

        // ç§»é™¤å›¾ç‰‡
        function removeImage(index) {
            images.splice(index, 1);
            updateImagesDisplay();
        }

        // ç”ŸæˆMarkdownå†…å®¹
        function generateMarkdown() {
            const formData = new FormData(document.getElementById('articleForm'));
            const data = Object.fromEntries(formData);
            
            // æ„å»ºYAML front matter
            let yaml = '---\n';
            yaml += `title: "${data.title}"\n`;
            yaml += `date: "${data.date}"\n`;
            yaml += `author: "${data.author}"\n`;
            yaml += `tags: [${tags.map(tag => `'${tag}'`).join(', ')}]\n`;
            yaml += `excerpt: "${data.excerpt}"\n`;
            yaml += `views: ${data.views || 1000}\n`;
            
            if (data.image_cover) {
                yaml += `image_cover: "${data.image_cover}"\n`;
            }
            if (data.image_cover_alt) {
                yaml += `image_cover_alt: "${data.image_cover_alt}"\n`;
            }
            if (data.video_id) {
                yaml += `video_url: "https://www.youtube.com/embed/${data.video_id}"\n`;
            } else {
                yaml += `video_url: ""\n`;
            }
            if (data.game_url) {
                yaml += `game_url: "${data.game_url}"\n`;
            } else {
                yaml += `game_url: ""\n`;
            }
            if (data.game_title) {
                yaml += `game_title: "${data.game_title}"\n`;
            } else {
                yaml += `game_title: ""\n`;
            }
            if (data.game_image) {
                yaml += `game_image: "${data.game_image}"\n`;
            } else {
                yaml += `game_image: ""\n`;
            }
            
            // æ·»åŠ å›¾ç‰‡æ•°ç»„
            if (images.length > 0) {
                yaml += `images: [\n`;
                images.forEach((image, index) => {
                    yaml += `  {\n`;
                    yaml += `    "url": "${image.url}",\n`;
                    yaml += `    "alt": "${image.alt}"\n`;
                    yaml += `  }${index < images.length - 1 ? ',' : ''}\n`;
                });
                yaml += `]\n`;
            } else {
                yaml += `images: []\n`;
            }
            
            yaml += '---\n\n';
            
            // æ·»åŠ æ–‡ç« å†…å®¹
            const markdown = yaml + data.content;
            
            return markdown;
        }

        // æ˜¾ç¤ºé¢„è§ˆ
        function showPreview() {
            const markdown = generateMarkdown();
            document.getElementById('previewContent').textContent = markdown;
            document.getElementById('previewSection').style.display = 'block';
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showAlert(message, type = 'success') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // è¡¨å•æäº¤
        document.getElementById('articleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            const title = document.getElementById('title').value.trim();
            const content = document.getElementById('content').value.trim();
            
            if (!title || !content) {
                showAlert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'error');
                return;
            }
            
            // ç”ŸæˆMarkdown
            const markdown = generateMarkdown();
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('Markdownæ–‡ä»¶å·²ç”Ÿæˆå¹¶ä¸‹è½½ï¼');
            showPreview();
        });

        // å®æ—¶é¢„è§ˆ
        document.getElementById('content').addEventListener('input', function() {
            if (document.getElementById('previewSection').style.display === 'block') {
                showPreview();
            }
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // Ctrl+S ä¿å­˜
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                document.getElementById('articleForm').dispatchEvent(new Event('submit'));
            }
            
            // Ctrl+Enter æ·»åŠ æ ‡ç­¾
            if (e.ctrlKey && e.key === 'Enter' && document.activeElement.id === 'tagInput') {
                e.preventDefault();
                addTag();
            }
        });

        // ç¼–è¾‘å™¨åŠŸèƒ½
        function insertMarkdown(before, after, placeholder) {
            const textarea = document.getElementById('content');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            const replacement = before + (selectedText || placeholder) + after;
            
            textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
            
            // é‡æ–°è®¾ç½®å…‰æ ‡ä½ç½®
            const newCursorPos = start + before.length + (selectedText ? selectedText.length : placeholder.length);
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            textarea.focus();
            
            // è§¦å‘è¾“å…¥äº‹ä»¶ä»¥æ›´æ–°é¢„è§ˆ
            textarea.dispatchEvent(new Event('input'));
        }

        // åˆ‡æ¢ç¼–è¾‘å™¨æ ‡ç­¾
        function switchTab(tab) {
            const editTab = document.getElementById('editTab');
            const previewTab = document.getElementById('previewTab');
            const textarea = document.getElementById('content');
            const preview = document.getElementById('editorPreview');
            
            if (tab === 'edit') {
                editTab.classList.add('active');
                previewTab.classList.remove('active');
                textarea.style.display = 'block';
                preview.style.display = 'none';
            } else {
                previewTab.classList.add('active');
                editTab.classList.remove('active');
                textarea.style.display = 'none';
                preview.style.display = 'block';
                updateEditorPreview();
            }
        }

        // æ›´æ–°ç¼–è¾‘å™¨é¢„è§ˆ
        function updateEditorPreview() {
            const content = document.getElementById('content').value;
            const preview = document.getElementById('editorPreview');
            
            // ç®€å•çš„Markdownè½¬HTMLï¼ˆå¯ä»¥åç»­ä½¿ç”¨æ›´å¼ºå¤§çš„åº“ï¼‰
            let html = content
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/~~(.*?)~~/g, '<del>$1</del>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>')
                .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" style="max-width: 100%; height: auto;">')
                .replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>')
                .replace(/^1\. (.*$)/gim, '<ol><li>$1</li></ol>')
                .replace(/^- (.*$)/gim, '<ul><li>$1</li></ul>')
                .replace(/\n/g, '<br>');
            
            preview.innerHTML = html;
        }

        // ç›‘å¬ç¼–è¾‘å™¨å†…å®¹å˜åŒ–
        document.getElementById('content').addEventListener('input', function() {
            // æ›´æ–°ç¼–è¾‘å™¨é¢„è§ˆ
            if (document.getElementById('previewTab').classList.contains('active')) {
                updateEditorPreview();
            }
            
            // æ›´æ–°æœ€ç»ˆé¢„è§ˆ
            if (document.getElementById('previewSection').style.display === 'block') {
                showPreview();
            }
        });
    </script>
</body>
</html> 