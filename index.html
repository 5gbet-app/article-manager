<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ç« ç®¡ç†æ¨¡å— - Markdownç¼–è¾‘å™¨</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="logo">
                <a href="#" class="logo">ğŸ“ æ–‡ç« ç®¡ç†</a>
            </div>
            <div class="header-buttons">
                <a href="./test.html" class="btn btn-primary">å¸®åŠ©</a>
                <a href="./test.html" class="btn btn-secondary">å…³äº</a>
            </div>
        </div>
    </header>

    <!-- Article Manager Section -->
    <section class="article-manager-section">
        <div class="article-manager-container">
            <div class="article-manager-header">
                <h1 class="article-manager-title">ğŸ“ æ–‡ç« ç®¡ç†æ¨¡å—</h1>
                <p class="article-manager-subtitle">åˆ›å»ºå’Œç®¡ç†åšå®¢æ–‡ç« ï¼Œæ”¯æŒæ‰€æœ‰é«˜çº§åŠŸèƒ½</p>
            </div>

            <form id="articleForm">
                <!-- åŸºæœ¬ä¿¡æ¯ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">æ–‡ç« æ ‡é¢˜ *</label>
                            <input type="text" class="form-input" id="title" name="title" required placeholder="è¾“å…¥æ–‡ç« æ ‡é¢˜">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å‘å¸ƒæ—¥æœŸ *</label>
                            <input type="date" class="form-input" id="date" name="date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ä½œè€… *</label>
                            <input type="text" class="form-input" id="author" name="author" required placeholder="ä½œè€…åç§°" value="ä½œè€…">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æµè§ˆé‡</label>
                            <input type="number" class="form-input" id="views" name="views" placeholder="æµè§ˆé‡" value="1000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">é˜…è¯»æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
                            <input type="number" class="form-input" id="reading_time" name="reading_time" placeholder="é˜…è¯»æ—¶é—´" value="5">
                        </div>
                    </div>
                </div>

                <!-- æ ‡ç­¾ç®¡ç† -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ·ï¸ æ ‡ç­¾ç®¡ç†</h3>
                    <div class="form-group">
                        <label class="form-label">æ·»åŠ æ ‡ç­¾</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-input" id="tagInput" placeholder="è¾“å…¥æ ‡ç­¾åç§°">
                            <button type="button" class="add-button" onclick="addTag()">æ·»åŠ æ ‡ç­¾</button>
                        </div>
                        <div class="tags-container" id="tagsContainer"></div>
                    </div>
                </div>

                <!-- æ‘˜è¦ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ“ æ–‡ç« æ‘˜è¦</h3>
                    <div class="form-group">
                        <label class="form-label">æ‘˜è¦å†…å®¹ *</label>
                        <textarea class="form-textarea" id="excerpt" name="excerpt" required placeholder="è¾“å…¥æ–‡ç« æ‘˜è¦ï¼Œç”¨äºåˆ—è¡¨é¡µæ˜¾ç¤º"></textarea>
                    </div>
                </div>

                <!-- å°é¢å›¾ç‰‡ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ–¼ï¸ å°é¢å›¾ç‰‡</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">å°é¢å›¾ç‰‡URL</label>
                            <input type="url" class="form-input" id="image_cover" name="image_cover" placeholder="https://example.com/images/cover.webp">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å°é¢å›¾ç‰‡Altæ–‡æœ¬</label>
                            <input type="text" class="form-input" id="image_cover_alt" name="image_cover_alt" placeholder="å°é¢å›¾ç‰‡æè¿°">
                        </div>
                    </div>
                </div>

                <!-- è§†é¢‘å’Œæ¸¸æˆ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ® è§†é¢‘å’Œæ¸¸æˆ</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">è§†é¢‘URL</label>
                            <input type="url" class="form-input" id="video_url" name="video_url" placeholder="è§†é¢‘åµŒå…¥é“¾æ¥">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ¸¸æˆURL</label>
                            <input type="url" class="form-input" id="game_url" name="game_url" placeholder="æ¸¸æˆè¯•ç©é“¾æ¥">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ¸¸æˆæ ‡é¢˜</label>
                            <input type="text" class="form-input" id="game_title" name="game_title" placeholder="æ¸¸æˆåç§°">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ¸¸æˆå›¾ç‰‡</label>
                            <input type="url" class="form-input" id="game_image" name="game_image" placeholder="æ¸¸æˆå°é¢å›¾ç‰‡">
                        </div>
                    </div>
                </div>

                <!-- å†…å®¹å›¾ç‰‡ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ–¼ï¸ å†…å®¹å›¾ç‰‡</h3>
                    <div class="form-group">
                        <label class="form-label">æ·»åŠ å†…å®¹å›¾ç‰‡</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="url" class="form-input" id="imageUrl" placeholder="å›¾ç‰‡URL">
                            <input type="text" class="form-input" id="imageAlt" placeholder="å›¾ç‰‡Altæ–‡æœ¬">
                            <button type="button" class="add-button" onclick="addImage()">æ·»åŠ å›¾ç‰‡</button>
                        </div>
                        <div class="images-container" id="imagesContainer"></div>
                    </div>
                </div>

                <!-- æ–‡ç« å†…å®¹ -->
                <div class="form-section">
                    <h3 class="form-section-title">ğŸ“„ æ–‡ç« å†…å®¹</h3>
                    <div class="form-group">
                        <label class="form-label">æ–‡ç« å†…å®¹ *</label>
                        <textarea class="form-textarea" id="content" name="content" required placeholder="è¾“å…¥æ–‡ç« å†…å®¹ï¼Œæ”¯æŒMarkdownæ ¼å¼" style="min-height: 300px;"></textarea>
                    </div>
                </div>

                <!-- æäº¤æŒ‰é’® -->
                <div class="submit-section">
                    <button type="submit" class="submit-button">
                        <i class="fas fa-save"></i> ç”ŸæˆMarkdownæ–‡ä»¶
                    </button>
                </div>
            </form>

            <!-- é¢„è§ˆåŒºåŸŸ -->
            <div class="preview-section" id="previewSection" style="display: none;">
                <h3 class="preview-title">ğŸ“‹ Markdowné¢„è§ˆ</h3>
                <div class="preview-content" id="previewContent"></div>
            </div>

            <!-- æ¶ˆæ¯æç¤º -->
            <div id="alertContainer"></div>
        </div>
    </section>

    <script>
        // å…¨å±€å˜é‡
        let tags = [];
        let images = [];

        // é¡µé¢åŠ è½½æ—¶è®¾ç½®é»˜è®¤æ—¥æœŸ
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
        });

        // æ·»åŠ æ ‡ç­¾
        function addTag() {
            const tagInput = document.getElementById('tagInput');
            const tag = tagInput.value.trim();
            
            if (tag && !tags.includes(tag)) {
                tags.push(tag);
                updateTagsDisplay();
                tagInput.value = '';
            }
        }

        // æ›´æ–°æ ‡ç­¾æ˜¾ç¤º
        function updateTagsDisplay() {
            const container = document.getElementById('tagsContainer');
            container.innerHTML = '';
            
            tags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-item';
                tagElement.innerHTML = `
                    <span>${tag}</span>
                    <button type="button" class="tag-remove" onclick="removeTag('${tag}')">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(tagElement);
            });
        }

        // ç§»é™¤æ ‡ç­¾
        function removeTag(tag) {
            tags = tags.filter(t => t !== tag);
            updateTagsDisplay();
        }

        // æ·»åŠ å›¾ç‰‡
        function addImage() {
            const urlInput = document.getElementById('imageUrl');
            const altInput = document.getElementById('imageAlt');
            const url = urlInput.value.trim();
            const alt = altInput.value.trim();
            
            if (url) {
                images.push({ url, alt });
                updateImagesDisplay();
                urlInput.value = '';
                altInput.value = '';
            }
        }

        // æ›´æ–°å›¾ç‰‡æ˜¾ç¤º
        function updateImagesDisplay() {
            const container = document.getElementById('imagesContainer');
            container.innerHTML = '';
            
            images.forEach((image, index) => {
                const imageElement = document.createElement('div');
                imageElement.className = 'image-item';
                imageElement.innerHTML = `
                    <div>
                        <strong>URL:</strong> ${image.url}
                    </div>
                    <div>
                        <strong>Alt:</strong> ${image.alt || 'æ— æè¿°'}
                    </div>
                    <button type="button" class="image-remove" onclick="removeImage(${index})">
                        <i class="fas fa-trash"></i> åˆ é™¤
                    </button>
                `;
                container.appendChild(imageElement);
            });
        }

        // ç§»é™¤å›¾ç‰‡
        function removeImage(index) {
            images.splice(index, 1);
            updateImagesDisplay();
        }

        // ç”ŸæˆMarkdownå†…å®¹
        function generateMarkdown() {
            const formData = new FormData(document.getElementById('articleForm'));
            const data = Object.fromEntries(formData);
            
            // æ„å»ºYAML front matter
            let yaml = '---\n';
            yaml += `title: "${data.title}"\n`;
            yaml += `date: "${data.date}"\n`;
            yaml += `author: "${data.author}"\n`;
            yaml += `tags: [${tags.map(tag => `'${tag}'`).join(', ')}]\n`;
            yaml += `excerpt: "${data.excerpt}"\n`;
            yaml += `views: ${data.views || 1000}\n`;
            
            if (data.image_cover) {
                yaml += `image_cover: "${data.image_cover}"\n`;
            }
            if (data.image_cover_alt) {
                yaml += `image_cover_alt: "${data.image_cover_alt}"\n`;
            }
            if (data.video_url) {
                yaml += `video_url: "${data.video_url}"\n`;
            } else {
                yaml += `video_url: ""\n`;
            }
            if (data.game_url) {
                yaml += `game_url: "${data.game_url}"\n`;
            } else {
                yaml += `game_url: ""\n`;
            }
            if (data.game_title) {
                yaml += `game_title: "${data.game_title}"\n`;
            } else {
                yaml += `game_title: ""\n`;
            }
            if (data.game_image) {
                yaml += `game_image: "${data.game_image}"\n`;
            } else {
                yaml += `game_image: ""\n`;
            }
            
            // æ·»åŠ å›¾ç‰‡æ•°ç»„
            if (images.length > 0) {
                yaml += `images: [\n`;
                images.forEach((image, index) => {
                    yaml += `  {\n`;
                    yaml += `    "url": "${image.url}",\n`;
                    yaml += `    "alt": "${image.alt}"\n`;
                    yaml += `  }${index < images.length - 1 ? ',' : ''}\n`;
                });
                yaml += `]\n`;
            } else {
                yaml += `images: []\n`;
            }
            
            yaml += '---\n\n';
            
            // æ·»åŠ æ–‡ç« å†…å®¹
            const markdown = yaml + data.content;
            
            return markdown;
        }

        // æ˜¾ç¤ºé¢„è§ˆ
        function showPreview() {
            const markdown = generateMarkdown();
            document.getElementById('previewContent').textContent = markdown;
            document.getElementById('previewSection').style.display = 'block';
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showAlert(message, type = 'success') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // è¡¨å•æäº¤
        document.getElementById('articleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // éªŒè¯å¿…å¡«å­—æ®µ
            const title = document.getElementById('title').value.trim();
            const content = document.getElementById('content').value.trim();
            
            if (!title || !content) {
                showAlert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ', 'error');
                return;
            }
            
            // ç”ŸæˆMarkdown
            const markdown = generateMarkdown();
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('Markdownæ–‡ä»¶å·²ç”Ÿæˆå¹¶ä¸‹è½½ï¼');
            showPreview();
        });

        // å®æ—¶é¢„è§ˆ
        document.getElementById('content').addEventListener('input', function() {
            if (document.getElementById('previewSection').style.display === 'block') {
                showPreview();
            }
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(e) {
            // Ctrl+S ä¿å­˜
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                document.getElementById('articleForm').dispatchEvent(new Event('submit'));
            }
            
            // Ctrl+Enter æ·»åŠ æ ‡ç­¾
            if (e.ctrlKey && e.key === 'Enter' && document.activeElement.id === 'tagInput') {
                e.preventDefault();
                addTag();
            }
        });
    </script>
</body>
</html> 