<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章管理模块 - Markdown编辑器</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="logo">
                <a href="#" class="logo">📝 文章管理</a>
            </div>
            <div class="header-buttons">
                <a href="./test.html" class="btn btn-primary">帮助</a>
                <a href="./test.html" class="btn btn-secondary">关于</a>
            </div>
        </div>
    </header>

    <!-- Article Manager Section -->
    <section class="article-manager-section">
        <div class="article-manager-container">
            <div class="article-manager-header">
                <h1 class="article-manager-title">📝 文章管理模块</h1>
                <p class="article-manager-subtitle">创建和管理博客文章，支持所有高级功能</p>
            </div>

            <form id="articleForm">
                <!-- 基本信息 -->
                <div class="form-section">
                    <h3 class="form-section-title">📋 基本信息</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">文章标题 *</label>
                            <input type="text" class="form-input" id="title" name="title" required placeholder="输入文章标题">
                        </div>
                        <div class="form-group">
                            <label class="form-label">发布日期 *</label>
                            <input type="date" class="form-input" id="date" name="date" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">作者 *</label>
                            <input type="text" class="form-input" id="author" name="author" required placeholder="作者名称" value="作者">
                        </div>
                        <div class="form-group">
                            <label class="form-label">浏览量</label>
                            <input type="number" class="form-input" id="views" name="views" placeholder="浏览量" value="1000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">阅读时间（分钟）</label>
                            <input type="number" class="form-input" id="reading_time" name="reading_time" placeholder="阅读时间" value="5">
                        </div>
                    </div>
                </div>

                <!-- 标签管理 -->
                <div class="form-section">
                    <h3 class="form-section-title">🏷️ 标签管理</h3>
                    <div class="form-group">
                        <label class="form-label">添加标签</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" class="form-input" id="tagInput" placeholder="输入标签名称">
                            <button type="button" class="add-button" onclick="addTag()">添加标签</button>
                        </div>
                        <div class="tags-container" id="tagsContainer"></div>
                    </div>
                </div>

                <!-- 摘要 -->
                <div class="form-section">
                    <h3 class="form-section-title">📝 文章摘要</h3>
                    <div class="form-group">
                        <label class="form-label">摘要内容 *</label>
                        <textarea class="form-textarea" id="excerpt" name="excerpt" required placeholder="输入文章摘要，用于列表页显示"></textarea>
                    </div>
                </div>

                <!-- 封面图片 -->
                <div class="form-section">
                    <h3 class="form-section-title">🖼️ 封面图片</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">封面图片URL</label>
                            <input type="url" class="form-input" id="image_cover" name="image_cover" placeholder="https://example.com/images/cover.webp">
                        </div>
                        <div class="form-group">
                            <label class="form-label">封面图片Alt文本</label>
                            <input type="text" class="form-input" id="image_cover_alt" name="image_cover_alt" placeholder="封面图片描述">
                        </div>
                    </div>
                </div>

                <!-- 视频和游戏 -->
                <div class="form-section">
                    <h3 class="form-section-title">🎮 视频和游戏</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">YouTube视频ID</label>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span style="color: #f0f0f0; font-size: 14px;">https://www.youtube.com/embed/</span>
                                <input type="text" class="form-input" id="video_id" name="video_id" placeholder="dQw4w9WgXcQ" style="flex: 1;">
                            </div>
                            <small style="color: rgba(240, 240, 240, 0.7); font-size: 12px; margin-top: 5px; display: block;">
                                只需填写YouTube视频ID，例如：dQw4w9WgXcQ
                            </small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">游戏URL</label>
                            <input type="url" class="form-input" id="game_url" name="game_url" placeholder="游戏试玩链接">
                        </div>
                        <div class="form-group">
                            <label class="form-label">游戏标题</label>
                            <input type="text" class="form-input" id="game_title" name="game_title" placeholder="游戏名称">
                        </div>
                        <div class="form-group">
                            <label class="form-label">游戏图片</label>
                            <input type="url" class="form-input" id="game_image" name="game_image" placeholder="游戏封面图片">
                        </div>
                    </div>
                </div>

                <!-- 内容图片 -->
                <div class="form-section">
                    <h3 class="form-section-title">🖼️ 内容图片</h3>
                    <div class="form-group">
                        <label class="form-label">添加内容图片</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <input type="url" class="form-input" id="imageUrl" placeholder="图片URL">
                            <input type="text" class="form-input" id="imageAlt" placeholder="图片Alt文本">
                            <button type="button" class="add-button" onclick="addImage()">添加图片</button>
                        </div>
                        <div class="images-container" id="imagesContainer"></div>
                    </div>
                </div>

                <!-- 文章内容 -->
                <div class="form-section">
                    <h3 class="form-section-title">📄 文章内容</h3>
                    <div class="form-group">
                        <label class="form-label">文章内容 *</label>
                        
                        <!-- 工具栏 -->
                        <div class="editor-toolbar">
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('**', '**', '粗体')" title="粗体">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('*', '*', '斜体')" title="斜体">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('~~', '~~', '删除线')" title="删除线">
                                <i class="fas fa-strikethrough"></i>
                            </button>
                            <div class="toolbar-separator"></div>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('# ', '', '标题1')" title="标题1">
                                <i class="fas fa-heading"></i>1
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('## ', '', '标题2')" title="标题2">
                                <i class="fas fa-heading"></i>2
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('### ', '', '标题3')" title="标题3">
                                <i class="fas fa-heading"></i>3
                            </button>
                            <div class="toolbar-separator"></div>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('- ', '', '列表项')" title="无序列表">
                                <i class="fas fa-list-ul"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('1. ', '', '列表项')" title="有序列表">
                                <i class="fas fa-list-ol"></i>
                            </button>
                            <div class="toolbar-separator"></div>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('[', '](url)', '链接文本')" title="链接">
                                <i class="fas fa-link"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('![', '](url)', '图片描述')" title="图片">
                                <i class="fas fa-image"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('`', '`', '代码')" title="行内代码">
                                <i class="fas fa-code"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('```\n', '\n```', '代码块')" title="代码块">
                                <i class="fas fa-file-code"></i>
                            </button>
                            <div class="toolbar-separator"></div>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('> ', '', '引用')" title="引用">
                                <i class="fas fa-quote-left"></i>
                            </button>
                            <button type="button" class="toolbar-btn" onclick="insertMarkdown('---\n', '', '')" title="分割线">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                        
                        <!-- 编辑器 -->
                        <div class="editor-container">
                            <textarea class="form-textarea editor-textarea" id="content" name="content" required placeholder="输入文章内容，支持Markdown格式" style="min-height: 300px;"></textarea>
                            <div class="editor-preview" id="editorPreview"></div>
                        </div>
                        
                        <!-- 编辑器切换 -->
                        <div class="editor-tabs">
                            <button type="button" class="tab-btn active" onclick="switchTab('edit')" id="editTab">
                                <i class="fas fa-edit"></i> 编辑
                            </button>
                            <button type="button" class="tab-btn" onclick="switchTab('preview')" id="previewTab">
                                <i class="fas fa-eye"></i> 预览
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 提交按钮 -->
                <div class="submit-section">
                    <button type="submit" class="submit-button">
                        <i class="fas fa-save"></i> 生成Markdown文件
                    </button>
                </div>
            </form>

            <!-- 预览区域 -->
            <div class="preview-section" id="previewSection" style="display: none;">
                <h3 class="preview-title">📋 Markdown预览</h3>
                <div class="preview-content" id="previewContent"></div>
            </div>

            <!-- 消息提示 -->
            <div id="alertContainer"></div>
        </div>
    </section>

    <script>
        // 全局变量
        let tags = [];
        let images = [];

        // 页面加载时设置默认日期
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;
        });

        // 添加标签
        function addTag() {
            const tagInput = document.getElementById('tagInput');
            const tag = tagInput.value.trim();
            
            if (tag && !tags.includes(tag)) {
                tags.push(tag);
                updateTagsDisplay();
                tagInput.value = '';
            }
        }

        // 更新标签显示
        function updateTagsDisplay() {
            const container = document.getElementById('tagsContainer');
            container.innerHTML = '';
            
            tags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-item';
                tagElement.innerHTML = `
                    <span>${tag}</span>
                    <button type="button" class="tag-remove" onclick="removeTag('${tag}')">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(tagElement);
            });
        }

        // 移除标签
        function removeTag(tag) {
            tags = tags.filter(t => t !== tag);
            updateTagsDisplay();
        }

        // 添加图片
        function addImage() {
            const urlInput = document.getElementById('imageUrl');
            const altInput = document.getElementById('imageAlt');
            const url = urlInput.value.trim();
            const alt = altInput.value.trim();
            
            if (url) {
                images.push({ url, alt });
                updateImagesDisplay();
                urlInput.value = '';
                altInput.value = '';
            }
        }

        // 更新图片显示
        function updateImagesDisplay() {
            const container = document.getElementById('imagesContainer');
            container.innerHTML = '';
            
            images.forEach((image, index) => {
                const imageElement = document.createElement('div');
                imageElement.className = 'image-item';
                imageElement.innerHTML = `
                    <div>
                        <strong>URL:</strong> ${image.url}
                    </div>
                    <div>
                        <strong>Alt:</strong> ${image.alt || '无描述'}
                    </div>
                    <button type="button" class="image-remove" onclick="removeImage(${index})">
                        <i class="fas fa-trash"></i> 删除
                    </button>
                `;
                container.appendChild(imageElement);
            });
        }

        // 移除图片
        function removeImage(index) {
            images.splice(index, 1);
            updateImagesDisplay();
        }

        // 生成Markdown内容
        function generateMarkdown() {
            const formData = new FormData(document.getElementById('articleForm'));
            const data = Object.fromEntries(formData);
            
            // 构建YAML front matter
            let yaml = '---\n';
            yaml += `title: "${data.title}"\n`;
            yaml += `date: "${data.date}"\n`;
            yaml += `author: "${data.author}"\n`;
            yaml += `tags: [${tags.map(tag => `'${tag}'`).join(', ')}]\n`;
            yaml += `excerpt: "${data.excerpt}"\n`;
            yaml += `views: ${data.views || 1000}\n`;
            
            if (data.image_cover) {
                yaml += `image_cover: "${data.image_cover}"\n`;
            }
            if (data.image_cover_alt) {
                yaml += `image_cover_alt: "${data.image_cover_alt}"\n`;
            }
            if (data.video_id) {
                yaml += `video_url: "https://www.youtube.com/embed/${data.video_id}"\n`;
            } else {
                yaml += `video_url: ""\n`;
            }
            if (data.game_url) {
                yaml += `game_url: "${data.game_url}"\n`;
            } else {
                yaml += `game_url: ""\n`;
            }
            if (data.game_title) {
                yaml += `game_title: "${data.game_title}"\n`;
            } else {
                yaml += `game_title: ""\n`;
            }
            if (data.game_image) {
                yaml += `game_image: "${data.game_image}"\n`;
            } else {
                yaml += `game_image: ""\n`;
            }
            
            // 添加图片数组
            if (images.length > 0) {
                yaml += `images: [\n`;
                images.forEach((image, index) => {
                    yaml += `  {\n`;
                    yaml += `    "url": "${image.url}",\n`;
                    yaml += `    "alt": "${image.alt}"\n`;
                    yaml += `  }${index < images.length - 1 ? ',' : ''}\n`;
                });
                yaml += `]\n`;
            } else {
                yaml += `images: []\n`;
            }
            
            yaml += '---\n\n';
            
            // 添加文章内容
            const markdown = yaml + data.content;
            
            return markdown;
        }

        // 显示预览
        function showPreview() {
            const markdown = generateMarkdown();
            document.getElementById('previewContent').textContent = markdown;
            document.getElementById('previewSection').style.display = 'block';
        }

        // 显示消息
        function showAlert(message, type = 'success') {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            container.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // 表单提交
        document.getElementById('articleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 验证必填字段
            const title = document.getElementById('title').value.trim();
            const content = document.getElementById('content').value.trim();
            
            if (!title || !content) {
                showAlert('请填写所有必填字段', 'error');
                return;
            }
            
            // 生成Markdown
            const markdown = generateMarkdown();
            
            // 创建下载链接
            const blob = new Blob([markdown], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase()}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('Markdown文件已生成并下载！');
            showPreview();
        });

        // 实时预览
        document.getElementById('content').addEventListener('input', function() {
            if (document.getElementById('previewSection').style.display === 'block') {
                showPreview();
            }
        });

        // 键盘快捷键
        document.addEventListener('keydown', function(e) {
            // Ctrl+S 保存
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                document.getElementById('articleForm').dispatchEvent(new Event('submit'));
            }
            
            // Ctrl+Enter 添加标签
            if (e.ctrlKey && e.key === 'Enter' && document.activeElement.id === 'tagInput') {
                e.preventDefault();
                addTag();
            }
        });

        // 编辑器功能
        function insertMarkdown(before, after, placeholder) {
            const textarea = document.getElementById('content');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            const replacement = before + (selectedText || placeholder) + after;
            
            textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
            
            // 重新设置光标位置
            const newCursorPos = start + before.length + (selectedText ? selectedText.length : placeholder.length);
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            textarea.focus();
            
            // 触发输入事件以更新预览
            textarea.dispatchEvent(new Event('input'));
        }

        // 切换编辑器标签
        function switchTab(tab) {
            const editTab = document.getElementById('editTab');
            const previewTab = document.getElementById('previewTab');
            const textarea = document.getElementById('content');
            const preview = document.getElementById('editorPreview');
            
            if (tab === 'edit') {
                editTab.classList.add('active');
                previewTab.classList.remove('active');
                textarea.style.display = 'block';
                preview.style.display = 'none';
            } else {
                previewTab.classList.add('active');
                editTab.classList.remove('active');
                textarea.style.display = 'none';
                preview.style.display = 'block';
                updateEditorPreview();
            }
        }

        // 更新编辑器预览
        function updateEditorPreview() {
            const content = document.getElementById('content').value;
            const preview = document.getElementById('editorPreview');
            
            // 简单的Markdown转HTML（可以后续使用更强大的库）
            let html = content
                .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/~~(.*?)~~/g, '<del>$1</del>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>')
                .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" style="max-width: 100%; height: auto;">')
                .replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>')
                .replace(/^1\. (.*$)/gim, '<ol><li>$1</li></ol>')
                .replace(/^- (.*$)/gim, '<ul><li>$1</li></ul>')
                .replace(/\n/g, '<br>');
            
            preview.innerHTML = html;
        }

        // 监听编辑器内容变化
        document.getElementById('content').addEventListener('input', function() {
            // 更新编辑器预览
            if (document.getElementById('previewTab').classList.contains('active')) {
                updateEditorPreview();
            }
            
            // 更新最终预览
            if (document.getElementById('previewSection').style.display === 'block') {
                showPreview();
            }
        });
    </script>
</body>
</html> 